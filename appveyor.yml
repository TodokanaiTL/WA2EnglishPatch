version: '{branch}-{build}'

skip_non_tags: true

environment:
  PATH: 'C:\Program Files (x86)\Inno Setup 6;%PATH%'

init:
  - ps: |-
      if ($env:APPVEYOR_REPO_TAG -eq "true") {
        Update-AppveyorBuild -Version $env:APPVEYOR_REPO_TAG_NAME.Substring(1)
      }

install:
  - choco install -y innosetup

before_build:
  - curl -LSso "bin/en.pak" "https://www.dropbox.com/sh/dl/8qd82pfpwulshf2/AAC_wJaNeZTdBpZiQbJuHC0Xa/en.pak"
  - curl -LSso "bin/WA2.exe" "https://www.dropbox.com/sh/dl/8qd82pfpwulshf2/AAAM9Im-IbLyMo4eMfn1EqZka/WA2.exe"
  - curl -LSso "bin/mv000.pak" "https://www.dropbox.com/sh/dl/8qd82pfpwulshf2/AACdMQoKt7Siw420_HxsC3PIa/mv000.pak"

build_script:
  - ps: ISCC /DVERSION=$($env:APPVEYOR_REPO_TAG_NAME.Substring(1)) src\WA2.iss

artifacts:
  - path: out\WA2_patch.exe
    name: WA2 patch

before_deploy:
  - ps: |-
      if (!$env:APPVEYOR_REPO_COMMIT_MESSAGE_EXTENDED) {
        $env:APPVEYOR_REPO_COMMIT_MESSAGE_EXTENDED = "* $env:APPVEYOR_REPO_COMMIT_MESSAGE"
      }

deploy:
  - provider: GitHub
    auth_token:
      secure: CZYw5sWK85gAhVnP4ZimstNyYwzpXASOgksyshNFciG5RYZFjURXhLURxwwdqWVA
    artifact: out\WA2_patch.exe
    description: $(APPVEYOR_REPO_COMMIT_MESSAGE_EXTENDED)
    force_update: true
    prerelease: false
    on:
      APPVEYOR_REPO_TAG: true
